<?xml version="1.0" encoding="utf-8" ?>
<component name="SearchRow" extends="RowList">
  <interface>
    <field id="rowSize" type="int" />
    <field id="itemData" type="associativeArray" onChange="setData" />
    <field id="query" type="string" />
    <field id="itemSelected" type="int" />
  </interface>
  <script type="text/brightscript">
  <![CDATA[
  sub init()
    m.top.itemComponentName = "ListPoster"
    m.top.content = getData()

    updateSize()

    m.top.showRowLabel = [ true ]
    m.top.rowLabelOffset = [0, 20]
    m.top.showRowCounter = [ true ]

    m.top.setFocus(true)
  end sub

  sub updateSize()
    m.top.numRows = 1
    m.top.rowSize = 5

    dimensions = m.top.getScene().currentDesignResolution

    border = 75
    m.top.translation = [border, border + 115]

    textHeight = 50
    itemWidth = (dimensions["width"] - border * 2) / m.top.rowSize
    itemHeight = itemWidth * 1.5 + textHeight

    m.top.itemSize = [dimensions["width"] - border*2, itemHeight]
    m.top.itemSpacing = [0, 50]

    m.top.rowItemSize = [ itemWidth, itemHeight ]
    m.top.rowItemSpacing = [0, 0]
  end sub

  sub setData()
    m.top.content = getData()
  end sub

  function getData()
    if m.top.itemData = invalid then
      data = CreateObject("roSGNode", "ContentNode")
      return data
    end if

    itemData = m.top.itemData
    rowSize = m.top.rowSize

    ' todo - Or get the old data? I can't remember...
    data = CreateObject("roSGNode", "ContentNode")
    ' TODO - pre-scan the item list and only add things which have results
    addRow(data, "Movies", "Movie")
    addRow(data, "Episodes", "Episode")
    addRow(data, "Artists", "AlbumArtist")
    addRow(data, "Albums", "Album")
    addRow(data, "Songs", "Audio")
    addRow(data, "People", "Person")

    return data
  end function

  function addRow(data, title, type_filter)
    itemData = m.top.itemData
    row = data.CreateChild("ContentNode")
    row.title = title
    for each item in itemData.SearchHints
      if item.type = type_filter
        child = row.createChild("SearchData")
        child.full_data = item
      end if
    end for
  end function
  ]]>
  </script>
</component>
